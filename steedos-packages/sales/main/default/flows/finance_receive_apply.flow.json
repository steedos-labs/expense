{"name":"合同收款审批","state":"enabled","is_deleted":false,"is_valid":true,"space":"65b07be6216dad06463837b2","app":"workflow","created":"2024-01-24T02:54:32.645Z","modified":"2024-01-24T02:54:32.645Z","modified_by":"bd6eb4d7-0eca-4c19-b9f5-30ce6a28bfc4","category":"65b07be6216dad06463837b2_912ba129ee6464951bc9cdac","instance_style":"table","current":{"_id":"0bd25b40d5f8cf1756d91f8c","_rev":1,"created":"2024-01-24T02:54:32.645Z","created_by":"bd6eb4d7-0eca-4c19-b9f5-30ce6a28bfc4","start_date":"2024-01-22T06:45:56.701Z","modified":"2024-01-24T02:54:32.645Z","modified_by":"bd6eb4d7-0eca-4c19-b9f5-30ce6a28bfc4","form":"e42b5d858d9b66648082d26c","fields":[{"name":"客户","code":"account","is_wide":true,"is_list_display":false,"is_searchable":true,"is_required":true,"is_multiselect":false,"_id":"65ae0f23ca48d306463cc9e2","steedos_field":{"name":"account","filterable":true,"hidden":false,"index":false,"is_name":false,"is_wide":true,"label":"客户","multiple":false,"readonly":false,"reference_to":"accounts","required":true,"searchable":false,"sort_no":120,"sortable":true,"type":"lookup","create":false},"type":"lookup","reference_to":"accounts","config":"{}"},{"name":"计划收款日期","code":"due_date","is_wide":false,"is_list_display":false,"is_searchable":true,"is_required":true,"is_multiselect":false,"_id":"65ae0f23ca48d306463cc9e3","steedos_field":{"name":"due_date","filterable":false,"hidden":false,"index":false,"is_name":false,"is_wide":false,"label":"计划收款日期","omit":false,"readonly":false,"required":true,"searchable":false,"sort_no":330,"sortable":true,"type":"date"},"type":"date"},{"name":"收款账户","code":"customer_bank","is_wide":false,"is_list_display":false,"is_searchable":false,"is_required":true,"is_multiselect":false,"_id":"65ae0f23ca48d306463cc9e4","steedos_field":{"name":"customer_bank","filterable":false,"hidden":false,"index":false,"is_name":false,"is_wide":false,"label":"收款账户","create":false,"multiple":false,"omit":false,"readonly":false,"reference_to":"company_account","required":true,"searchable":false,"sort_no":200,"sortable":false,"type":"lookup"},"type":"lookup","reference_to":"company_account","config":"{}"},{"name":"收款金额","code":"amount","is_wide":false,"is_list_display":false,"is_searchable":false,"is_required":false,"is_multiselect":false,"_id":"65ae0f23ca48d306463cc9e5","steedos_field":{"name":"amount","create":true,"data_type":"currency","filterable":false,"generated":false,"hidden":false,"index":false,"is_name":false,"is_wide":false,"label":"收款金额","multiple":false,"precision":18,"primary":false,"readonly":false,"scale":2,"searchable":false,"show_as_qr":false,"sort_no":130,"sortable":false,"summary_field":"amount_invoicing","summary_filters":[],"summary_object":"contract_receive_detail","summary_type":"sum","type":"summary","unique":false,"write_requires_master_read":false,"required":false},"type":"number","digits":2},{"name":"折让金额","code":"amount_discount","is_wide":false,"is_list_display":false,"is_searchable":false,"is_required":false,"is_multiselect":false,"_id":"65ae0f23ca48d306463cc9e6","steedos_field":{"name":"amount_discount","create":true,"data_type":"currency","filterable":false,"generated":false,"hidden":false,"index":false,"is_name":false,"is_wide":false,"label":"折让金额","multiple":false,"precision":18,"primary":false,"readonly":false,"scale":2,"searchable":false,"show_as_qr":false,"sort_no":132,"sortable":false,"summary_field":"amount_discount","summary_filters":[],"summary_object":"contract_receive_detail","summary_type":"sum","type":"summary","unique":false,"write_requires_master_read":false,"required":false},"type":"number","digits":2},{"name":"核销金额","code":"amount_write","is_wide":false,"is_list_display":false,"is_searchable":false,"is_required":false,"is_multiselect":false,"_id":"65ae0f23ca48d306463cc9e7","steedos_field":{"name":"amount_write","create":true,"data_type":"currency","filterable":false,"generated":false,"hidden":false,"index":false,"is_name":false,"is_wide":false,"label":"核销金额","multiple":false,"precision":18,"primary":false,"readonly":false,"scale":2,"searchable":false,"show_as_qr":false,"sort_no":134,"sortable":false,"summary_field":"amount_write","summary_filters":[],"summary_object":"contract_receive_detail","summary_type":"sum","type":"summary","unique":false,"write_requires_master_read":false,"required":false},"type":"number","digits":2},{"name":"收款说明","code":"amount_description","is_wide":true,"is_list_display":false,"is_searchable":false,"is_required":false,"is_multiselect":false,"_id":"65ae0f23ca48d306463cc9e8","steedos_field":{"name":"amount_description","filterable":false,"hidden":false,"index":false,"is_name":false,"is_wide":true,"label":"收款说明","omit":false,"readonly":false,"required":false,"rows":0,"searchable":false,"sort_no":340,"sortable":false,"type":"textarea"},"type":"input","is_textarea":true},{"type":"table","name":"合同收款明细","code":"contract_receive_detail","is_wide":true,"is_required":false,"fields":[{"name":"合同","code":"contract_receive_detail_contract","is_wide":true,"is_list_display":false,"is_searchable":false,"is_required":true,"is_multiselect":false,"_id":"65ae0f23ca48d306463cc9e9","steedos_field":{"name":"contract","create":true,"filterable":false,"generated":false,"hidden":false,"index":false,"inlineHelpText":"只能选择收款中选择的客户关联的合同。","is_name":false,"is_wide":true,"label":"合同","multiple":false,"primary":false,"readonly":false,"reference_to":"sales_orders","required":true,"searchable":false,"show_as_qr":false,"sort_no":110,"sortable":false,"type":"master_detail","unique":false,"write_requires_master_read":true,"depend_on":["finance_receive"],"amis":{"autoFill":{"fillMapping":{"date":"${signed_date}","amount":"${amount}","contract_receive_amount":"${left_receive}","invoice_amount":"${billing_money_receive}"},"api":{"url":"${context.rootUrl}/api/v1/sales_orders/${contract}","method":"get"}}},"_filtersFunction":"function anonymous(filters,values\n) {\n\n  const queryResult = Steedos.authRequest(`/graphql`, {\n                            type: 'POST', async: false, \n                            data: JSON.stringify({\n                              query: `{finance_receive(filters: [\"_id\",\"=\", `+ JSON.stringify(values.finance_receive) + `]){_id, account}}`\n                            })\n                          });\n        let finance_receive = queryResult.data.finance_receive\n        console.log(\"========123\",finance_receive)\n    if(finance_receive && finance_receive.length){\n        return [\"customer\",\"=\",finance_receive[0].account]\n    }                    \n\n}"},"type":"lookup","reference_to":"sales_orders","config":"{\"amis\":{\"autoFill\":{\"fillMapping\":{\"date\":\"${signed_date}\",\"amount\":\"${amount}\",\"contract_receive_amount\":\"${left_receive}\",\"invoice_amount\":\"${billing_money_receive}\"},\"api\":{\"url\":\"${context.rootUrl}/api/v1/sales_orders/${contract}\",\"method\":\"get\"}}}}"},{"name":"合同日期","code":"contract_receive_detail_date","is_wide":false,"is_list_display":false,"is_searchable":false,"is_required":false,"is_multiselect":false,"_id":"65ae0f23ca48d306463cc9ea","steedos_field":{"name":"date","create":true,"filterable":false,"generated":false,"hidden":false,"index":false,"is_name":false,"is_wide":false,"label":"合同日期","multiple":false,"primary":false,"readonly":false,"required":false,"searchable":false,"show_as_qr":false,"sort_no":115,"sortable":false,"unique":false,"write_requires_master_read":false,"type":"date","amis":{"disabled":true}},"type":"date"},{"name":"合同金额","code":"contract_receive_detail_amount","is_wide":false,"is_list_display":false,"is_searchable":false,"is_required":false,"is_multiselect":false,"default_value":0,"_id":"65ae0f23ca48d306463cc9eb","steedos_field":{"name":"amount","create":true,"defaultValue":0,"filterable":false,"generated":false,"hidden":false,"index":false,"is_name":false,"is_wide":false,"label":"合同金额","multiple":false,"primary":false,"readonly":false,"required":false,"searchable":false,"show_as_qr":false,"sort_no":115,"sortable":false,"unique":false,"write_requires_master_read":false,"type":"currency","scale":2,"amis":{"disabled":true}},"type":"number","digits":2},{"name":"收款金额","code":"contract_receive_detail_amount_invoicing","is_wide":false,"is_list_display":false,"is_searchable":false,"is_required":true,"is_multiselect":false,"_id":"65ae0f23ca48d306463cc9ec","steedos_field":{"name":"amount_invoicing","create":true,"filterable":false,"generated":false,"hidden":false,"index":false,"is_name":false,"is_wide":false,"label":"收款金额","multiple":false,"precision":18,"primary":false,"readonly":false,"required":true,"scale":2,"searchable":false,"show_as_qr":false,"sort_no":140,"sortable":false,"type":"currency","unique":false,"write_requires_master_read":false},"type":"number","digits":2},{"name":"折让金额","code":"contract_receive_detail_amount_discount","is_wide":false,"is_list_display":false,"is_searchable":false,"is_required":false,"is_multiselect":false,"default_value":0,"_id":"65ae0f23ca48d306463cc9ed","steedos_field":{"name":"amount_discount","create":true,"filterable":false,"generated":false,"hidden":false,"index":false,"is_name":false,"is_wide":false,"label":"折让金额","defaultValue":0,"multiple":false,"precision":18,"primary":false,"readonly":false,"required":false,"scale":2,"searchable":false,"show_as_qr":false,"sort_no":141,"sortable":false,"type":"currency","unique":false,"write_requires_master_read":false},"type":"number","digits":2},{"name":"核销金额","code":"contract_receive_detail_amount_write","is_wide":false,"is_list_display":false,"is_searchable":false,"is_required":false,"is_multiselect":false,"_id":"65ae0f23ca48d306463cc9ee","steedos_field":{"name":"amount_write","label":"核销金额","inlineHelpText":"收款金额+折让金额+预收款抵扣金额","data_type":"currency","filterable":false,"formula":"ROUND(amount_invoicing+amount_discount+amount_pre_receive,2)","formula_blank_value":"zeroes","hidden":false,"index":false,"is_name":false,"is_wide":false,"omit":false,"precision":18,"readonly":false,"required":false,"scale":2,"searchable":false,"sort_no":142,"sortable":false,"type":"formula"},"type":"number","digits":2}],"_id":"65ae0f23ca48d306463cc9ef","relatedId":"contract_receive_detail.finance_receive"}],"name_forumla":"{name}"},"api_name":"finance_receive_apply","created_by":"bd6eb4d7-0eca-4c19-b9f5-30ce6a28bfc4","import":true,"owner":"bd6eb4d7-0eca-4c19-b9f5-30ce6a28bfc4","company_id":"65b07be6216dad06463837b2","company_ids":["65b07be6216dad06463837b2"],"historys":[],"category_name":"应收管理","instance_number_rules":[],"flows":[{"_id":"34ebca77ba884ad3505f04da","space":"65b07be6216dad06463837b2","form":"e42b5d858d9b66648082d26c","name_formula":"","code_formula":"","is_valid":true,"flowtype":"new","state":"enabled","description":null,"help_text":null,"error_message":"","current_no":2,"is_deleted":false,"created":"2024-01-24T02:54:32.646Z","created_by":"bd6eb4d7-0eca-4c19-b9f5-30ce6a28bfc4","modified":"2024-01-24T02:54:32.646Z","modified_by":"bd6eb4d7-0eca-4c19-b9f5-30ce6a28bfc4","name":"合同收款审批","app":"workflow","category":"65b07be6216dad06463837b2_912ba129ee6464951bc9cdac","object_name":"finance_receive","instance_fields":[{"name":"account","label":"客户","required":true},{"name":"due_date","label":"计划收款日期","required":true},{"name":"customer_bank","label":"收款账户","required":true},{"name":"amount","label":"收款金额","required":false},{"name":"amount_discount","label":"折让金额","required":false},{"name":"amount_write","label":"核销金额","required":false},{"name":"amount_description","label":"收款说明","required":false}],"instance_table_fields":[{"detail_field_fullname":"contract_receive_detail.finance_receive","sort_order":"asc","field_names":["contract","date","amount","amount_invoicing","amount_discount","amount_write"],"value":"合同收款明细","label":"合同收款明细"}],"perms":{"_id":"e74f704baa5a79073f426157","users_can_add":[],"orgs_can_add":["65b07be6216dad06463837b2"],"users_can_monitor":[],"orgs_can_monitor":[],"users_can_admin":[],"orgs_can_admin":[]},"current":{"_id":"949aec7c7c4db54504f669a9","created":"2024-01-24T02:54:32.646Z","created_by":"bd6eb4d7-0eca-4c19-b9f5-30ce6a28bfc4","steps":[{"name":"开始","step_type":"start","deal_type":"","description":"","posx":361.75,"posy":446,"timeout_hours":168,"approver_users":[],"approver_orgs":[],"approver_user_field":"","approver_org_field":"","approver_roles":[],"approver_step":"","lines":[{"name":"","state":"submitted","to_step":"51ffe10b-558f-40a3-ab28-8d328345cfbb","description":"","timeout_line":false,"_id":"Jyp6mSLrgRJ5sMMji"}],"permissions":{"__form":"editable","account":"editable","due_date":"editable","customer_bank":"editable","amount":"editable","amount_discount":"editable","amount_write":"editable","amount_description":"editable","contract_receive_detail":"editable","contract_receive_detail_contract":"editable","contract_receive_detail_date":"editable","contract_receive_detail_amount":"editable","contract_receive_detail_amount_invoicing":"editable","contract_receive_detail_amount_discount":"editable","contract_receive_detail_amount_write":"editable"},"can_edit_main_attach":false,"can_edit_normal_attach":true,"always_enter_step":true,"_id":"9WJPsygoNjAkaoZu9","fields_modifiable":[],"approver_roles_api_name":[],"approver_hr_roles_name":[],"approver_hr_roles_api_name":[],"approver_roles_name":[]},{"name":"结束","step_type":"end","deal_type":"","description":"","posx":1143.25,"posy":446,"approver_users":[],"approver_orgs":[],"approver_user_field":"","approver_org_field":"","approver_roles":[],"approver_step":"","permissions":{},"always_enter_step":true,"_id":"XGgdAA5MeLtXxpm8G","fields_modifiable":[],"approver_roles_api_name":[],"approver_hr_roles_name":[],"approver_hr_roles_api_name":[],"approver_roles_name":[]},{"name":"审批","step_type":"sign","deal_type":"pickupAtRuntime","description":"","posx":793,"posy":376,"timeout_hours":168,"approver_users":[],"approver_orgs":[],"approver_user_field":"","approver_org_field":"","approver_roles":[],"approver_hr_roles":[],"approver_step":"","lines":[{"name":"","state":"approved","to_step":"XGgdAA5MeLtXxpm8G","description":"","timeout_line":false}],"permissions":{},"disableCC":false,"allowDistribute":false,"can_edit_main_attach":false,"can_edit_normal_attach":true,"cc_must_finished":false,"cc_alert":false,"allow_pick_approve_users":false,"allow_skip":false,"cc_has_edit_permission":false,"always_enter_step":true,"enter_step_condition":"","_id":"51ffe10b-558f-40a3-ab28-8d328345cfbb","fields_modifiable":[],"approver_roles_api_name":[],"approver_hr_roles_name":[],"approver_hr_roles_api_name":[],"approver_roles_name":[]}],"_rev":1,"flow":"34ebca77ba884ad3505f04da","form_version":"0bd25b40d5f8cf1756d91f8c","modified":"2024-01-24T02:54:32.646Z","modified_by":"bd6eb4d7-0eca-4c19-b9f5-30ce6a28bfc4","start_date":"2024-01-22T06:45:23.407Z"},"forbid_initiate_instance":true,"api_name":"finance_receive_apply","historys":[],"import":true,"owner":"bd6eb4d7-0eca-4c19-b9f5-30ce6a28bfc4","company_id":"65b07be6216dad06463837b2","company_ids":["65b07be6216dad06463837b2"],"object_workflows":[{"_id":"Ah76x3byQHXv8RJHR","name":"合同收款审批-收款","object_name":"finance_receive","flow_id":"34ebca77ba884ad3505f04da","sync_attachment":"lastest","sync_type":"every_step","sync_direction":"both","field_map_back":[{"object_field":"account","workflow_field":"account"},{"object_field":"due_date","workflow_field":"due_date"},{"object_field":"customer_bank","workflow_field":"customer_bank"},{"object_field":"amount","workflow_field":"amount"},{"object_field":"amount_discount","workflow_field":"amount_discount"},{"object_field":"amount_write","workflow_field":"amount_write"},{"object_field":"amount_description","workflow_field":"amount_description"},{"object_field":"contract_receive_detail.contract","workflow_field":"contract_receive_detail.contract_receive_detail_contract"},{"object_field":"contract_receive_detail.date","workflow_field":"contract_receive_detail.contract_receive_detail_date"},{"object_field":"contract_receive_detail.amount","workflow_field":"contract_receive_detail.contract_receive_detail_amount"},{"object_field":"contract_receive_detail.amount_invoicing","workflow_field":"contract_receive_detail.contract_receive_detail_amount_invoicing"},{"object_field":"contract_receive_detail.amount_discount","workflow_field":"contract_receive_detail.contract_receive_detail_amount_discount"},{"object_field":"contract_receive_detail.amount_write","workflow_field":"contract_receive_detail.contract_receive_detail_amount_write"}],"field_map":[{"object_field":"account","workflow_field":"account"},{"object_field":"due_date","workflow_field":"due_date"},{"object_field":"customer_bank","workflow_field":"customer_bank"},{"object_field":"amount","workflow_field":"amount"},{"object_field":"amount_discount","workflow_field":"amount_discount"},{"object_field":"amount_write","workflow_field":"amount_write"},{"object_field":"amount_description","workflow_field":"amount_description"},{"object_field":"contract_receive_detail.contract","workflow_field":"contract_receive_detail.contract_receive_detail_contract"},{"object_field":"contract_receive_detail.date","workflow_field":"contract_receive_detail.contract_receive_detail_date"},{"object_field":"contract_receive_detail.amount","workflow_field":"contract_receive_detail.contract_receive_detail_amount"},{"object_field":"contract_receive_detail.amount_invoicing","workflow_field":"contract_receive_detail.contract_receive_detail_amount_invoicing"},{"object_field":"contract_receive_detail.amount_discount","workflow_field":"contract_receive_detail.contract_receive_detail_amount_discount"},{"object_field":"contract_receive_detail.amount_write","workflow_field":"contract_receive_detail.contract_receive_detail_amount_write"}],"lock_record_after_approval":true,"required_details":["contract_receive_detail.finance_receive"]}]}]}