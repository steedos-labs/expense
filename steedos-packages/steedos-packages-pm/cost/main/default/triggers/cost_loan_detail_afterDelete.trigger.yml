name: cost_loan_detail_afterDelete
listenTo: cost_loan_detail
when:
  - afterDelete
isEnabled: true
handler: |-
  // _ : lodash
  // moment: moment
  // validator: validator
  // ctx
  // objects
  // services
  const { doc, previousDoc, userId, spaceId } = ctx.params;
  const mydoc = await ctx.broker.call('objectql.find', {
      objectName: 'cost_reimburse_detail',
      query: {
          fields: ['_id', 'status', 'instance'],
          filters: ['_id', '=', previousDoc.cost_code],
      },
  }
  );
  const modifyStateDoc = await ctx.broker.call('objectql.directUpdate', {
      objectName: 'cost_reimburse_detail',
      doc: {
          status: 'before',
          instance: null
      },
      id: mydoc[0]._id
  },
  );
