name: account
depend_on:
  - contract
label: 收款方
required: true
filtersFunction: !!js/function |
  function (filters, values) {
      const contract = values.contract;
      if (!contract) {
        return ['_id', '=', 'none'];
      } else {
        const queryResult = Steedos.authRequest(`/graphql`, {
                              type: 'POST', async: false, 
                              data: JSON.stringify({
                                query: `{contracts(filters: ["_id","=", `+ JSON.stringify(contract) + `]){_id, othercompany__expand{_id}}}`
                              })
                            });
        const accounts = queryResult && queryResult.data && queryResult.data.contracts[0].othercompany__expand;
        if (!accounts || accounts.length < 1) {
          throw new Error('此合同未填写相对方信息，请补充相应信息！');
        }
        const ids = new Array();
        for (const item of accounts) {
          ids.push(item._id);
        }
        return ["_id", "in", ids];
      }
  }
reference_to: accounts
relatedList: true
searchable: true
sort_no: 180
type: lookup
