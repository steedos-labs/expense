name: upload
amis_schema: |-
  {
            "type": "service",
            "body": [
                {
                    "type": "form",
                    "title": "表单",
                    "body": [
                        {
                            "type": "input-file",
                            "label": "",
                            "name": "file",
                            "id": "u:a58d02614e04",
                            "btnLabel": "上传",
                            "&":"$$",
                            "btnClassName": "m-0",
                            "className": "p-0",
                            "multiple": false,
                            "maxLength": 10,
                            "submitType": "asUpload",
                            "uploadType": "fileReceptor",
                            "proxy": false,
                            "drag": false,
                            "autoUpload": true,
                            "useChunk": false,
                            "joinValues": false,
                            "extractValue": false,
                            "valueField": "version_id",
                            "receiver": {
                                "url": "${context.rootUrl}/s3/",
                                "headers": {
                                    "Authorization": "Bearer ${context.tenantId},${context.authToken}"
                                },
                                "method": "post",
                                "messages": {},
                                "dataType": "form-data",
                                "requestAdaptor": "api.data.append('record_id', api.body._master.recordId);api.data.append('object_name', api.body._master.objectName); api.data.append('space', api.body.global.spaceId);api.data.append('owner', api.body.global.userId);api.data.append('owner_name', api.body.global.user.name);return api;"
                            },
                            "onEvent": {
                                "success": {
                                    "weight": 0,
                                    "actions": [
                                        {
                                            "componentId": "u:5f901c0b917b",
                                            "args": {},
                                            "actionType": "clear"
                                        },
                                        {
                                            "componentId": "",
                                            "args": {
                                                "msgType": "success",
                                                "position": "top-right",
                                                "closeButton": true,
                                                "showIcon": true,
                                                "msg": "${'cms_files.upload.message_success' | t}"
                                            },
                                            "actionType": "toast"
                                        },
                                        {
                                          "componentId": "",
                                          "args": {},
                                          "actionType": "custom",
                                          "script": "doAction({\n  componentId: `steedos-record-related-list-${context.props.data.objectName}`,\n  actionType: \"setValue\",\n  args: {\n    value: { \"$count\": undefined }\n  }\n}); SteedosUI.getRef(context.props.data.scopeId).parent?.getComponentById(`listview_${context.props.data.objectName}`).handleAction({}, { actionType: 'reload'})"
                                        }
                                    ]
                                }
                            }
                        }
                    ],
                    "id": "u:5f901c0b917b",
                    "wrapWithPanel": false
                }
            ]
        }
is_enable: true
label: 列表按钮
'on': list
type: amis_button
visible: true