{"name":"合同付款审批","state":"enabled","is_deleted":false,"is_valid":true,"space":"65a8bd3c8a8fe305be00e788","app":"workflow","created":"2024-01-18T06:20:45.000Z","modified":"2024-01-18T06:28:40.887Z","modified_by":"bd6eb4d7-0eca-4c19-b9f5-30ce6a28bfc4","category":"65a8bd3c8a8fe305be00e788_912ba129ee6464951bc9cda1","instance_style":"table","company_id":"65a8bd3c8a8fe305be00e788","current":{"_id":"4d9983f0-7f7c-4000-a027-30f1678c","name_forumla":"{name}","form":"4d9983f0-7f7c-4000-a027-30f1678c","_rev":1,"created":"2024-01-18T06:20:45.000Z","modified":"2024-01-18T06:28:40.883Z","fields":[{"name":"供应商","code":"supplier","is_wide":false,"is_list_display":false,"is_searchable":false,"is_required":true,"is_multiselect":false,"_id":"65a8c5178a8fe305be00e7d8","steedos_field":{"name":"supplier","filterable":false,"hidden":false,"index":false,"is_name":false,"is_wide":false,"label":"供应商","multiple":false,"omit":false,"readonly":false,"reference_to":"accounts","required":true,"searchable":true,"sort_no":60,"sortable":false,"type":"lookup"},"type":"lookup","reference_to":"accounts","config":"{}"},{"name":"供应商收款账户","code":"supplier_bank","is_wide":false,"is_list_display":false,"is_searchable":false,"is_required":false,"is_multiselect":false,"_id":"65a8c5178a8fe305be00e7d9","steedos_field":{"name":"supplier_bank","filterable":false,"hidden":false,"index":false,"is_name":false,"is_wide":false,"label":"供应商收款账户","create":false,"multiple":false,"omit":false,"depend_on":["supplier"],"readonly":false,"reference_to":"account_banks","required":false,"searchable":false,"sort_no":70,"sortable":false,"type":"lookup","inlineHelpText":"请选择此供应商的收款账户。","filtersFunction":"function(filters,values) {\n  return [\n    ['account','=',values.supplier]\n  ];\n}"},"type":"lookup","reference_to":"account_banks","config":"{}"},{"name":"付款金额","code":"amount","is_wide":false,"is_list_display":false,"is_searchable":false,"is_required":false,"is_multiselect":false,"_id":"65a8c5178a8fe305be00e7da","steedos_field":{"name":"amount","create":true,"data_type":"number","filterable":false,"generated":false,"hidden":false,"index":false,"is_name":false,"is_wide":false,"label":"付款金额","multiple":false,"precision":18,"primary":false,"readonly":false,"scale":2,"searchable":false,"show_as_qr":false,"sort_no":130,"sortable":false,"summary_field":"amount","summary_object":"finance_payment_report_item","summary_type":"sum","type":"summary","unique":false,"write_requires_master_read":false,"required":false},"type":"number","digits":2},{"name":"计划付款日期","code":"due_date","is_wide":false,"is_list_display":false,"is_searchable":true,"is_required":true,"is_multiselect":false,"_id":"65a8c5178a8fe305be00e7db","steedos_field":{"name":"due_date","filterable":false,"hidden":false,"index":false,"is_name":false,"is_wide":false,"label":"计划付款日期","omit":false,"readonly":false,"required":true,"searchable":false,"sort_no":130,"sortable":true,"type":"date"},"type":"date"},{"name":"付款账户","code":"payment_account","is_wide":false,"is_list_display":false,"is_searchable":false,"is_required":true,"is_multiselect":false,"_id":"65a8c5178a8fe305be00e7dc","steedos_field":{"name":"payment_account","label":"付款账户","reference_to":"company_account","required":true,"sort_no":135,"type":"lookup"},"type":"lookup","reference_to":"company_account","config":"{}"},{"name":"付款单编号","code":"id","is_wide":false,"is_list_display":false,"is_searchable":true,"is_required":false,"is_multiselect":false,"_id":"65a8c5178a8fe305be00e7dd","steedos_field":{"name":"id","filterable":true,"formula":"FKD-{00000}","hidden":false,"index":false,"is_name":true,"is_wide":false,"label":"付款单编号","omit":false,"readonly":true,"visible_on":"{{global.mode ==='read' ? true : false}}","required":false,"searchable":false,"sort_no":210,"sortable":true,"type":"autonumber"},"type":"input"},{"name":"单据编号","code":"billno","is_wide":false,"is_list_display":false,"is_searchable":false,"is_required":false,"is_multiselect":false,"_id":"65a8c5178a8fe305be00e7de","steedos_field":{"name":"billno","filterable":true,"hidden":false,"index":false,"is_name":false,"is_wide":false,"label":"单据编号","omit":false,"readonly":false,"required":false,"searchable":false,"sort_no":220,"sortable":false,"type":"text"},"type":"input"},{"name":"备注","code":"amount_description","is_wide":true,"is_list_display":false,"is_searchable":false,"is_required":false,"is_multiselect":false,"_id":"65a8c5178a8fe305be00e7df","steedos_field":{"name":"amount_description","filterable":false,"hidden":false,"index":false,"is_name":false,"is_wide":true,"label":"备注","omit":false,"readonly":false,"required":false,"rows":0,"searchable":false,"sort_no":300,"sortable":false,"type":"textarea"},"type":"input","is_textarea":true},{"type":"table","name":"付款明细","code":"finance_payment_report_item","is_wide":true,"is_required":false,"fields":[{"name":"付款记录编号","code":"finance_payment_report_item_id","is_wide":false,"is_list_display":false,"is_searchable":true,"is_required":false,"is_multiselect":false,"_id":"65a8c5178a8fe305be00e7e0","steedos_field":{"name":"id","filterable":true,"formula":"FKMX-{00000}","hidden":false,"index":false,"is_name":true,"is_wide":false,"label":"付款记录编号","omit":false,"readonly":true,"visible_on":"{{global.mode ==='read' ? true : false}}","required":false,"searchable":false,"sort_no":80,"sortable":true,"type":"autonumber"},"type":"input"},{"name":"合同","code":"finance_payment_report_item_purchase_order","is_wide":false,"is_list_display":false,"is_searchable":true,"is_required":true,"is_multiselect":false,"_id":"65a8c5178a8fe305be00e7e1","steedos_field":{"name":"purchase_order","filterable":true,"hidden":false,"index":false,"is_name":false,"is_wide":false,"label":"合同","omit":false,"readonly":false,"reference_to":"purchase_orders","required":true,"searchable":false,"sort_no":70,"sortable":true,"type":"master_detail","create":false,"write_requires_master_read":true,"inlineHelpText":"请选择此供应商的应付合同。","amis":{"autoFill":{"supplier":"${supplier}"}},"_filtersFunction":"function anonymous(filters,values\n) {\n\n    const report_id = values.report_id;\n    if (!report_id) {\n      return ['_id', '=', 'none'];\n    } else {\n      const queryResult = Steedos.authRequest(`/graphql`, {\n                            type: 'POST', async: false, \n                            data: JSON.stringify({\n                              query: `{finance_payment_reports(filters: [\"_id\",\"=\", `+ JSON.stringify(report_id) + `]){_id, supplier}}`\n                            })\n                          });\n      const supplier = queryResult.data.finance_payment_reports[0].supplier;\n      if (!supplier || supplier == \"\") {\n        throw new Error('此付款单的供应商信息有误，请补充相应信息！');\n      }\n      return [\"supplier\", \"=\", supplier];\n    }\n\n}"},"type":"lookup","reference_to":"purchase_orders","config":"{\"amis\":{\"autoFill\":{\"supplier\":\"${supplier}\"}}}"},{"name":"合同金额","code":"finance_payment_report_item_contract_amount","is_wide":false,"is_list_display":false,"is_searchable":false,"is_required":false,"is_multiselect":false,"_id":"65a8c5178a8fe305be00e7e2","steedos_field":{"name":"contract_amount","data_type":"currency","filterable":false,"formula":"purchase_order.amount","formula_blank_value":"zeroes","hidden":false,"index":false,"is_name":false,"is_wide":false,"label":"合同金额","omit":false,"precision":18,"readonly":false,"required":false,"scale":2,"searchable":false,"sort_no":630,"sortable":false,"type":"formula","visible_on":"{{global.mode ==='read' ? true : false}}"},"type":"number","digits":2},{"name":"付款金额","code":"finance_payment_report_item_amount","is_wide":false,"is_list_display":false,"is_searchable":true,"is_required":true,"is_multiselect":false,"_id":"65a8c5178a8fe305be00e7e3","steedos_field":{"name":"amount","filterable":false,"hidden":false,"index":false,"is_name":false,"is_wide":false,"label":"付款金额","omit":false,"precision":18,"readonly":false,"required":true,"scale":2,"searchable":false,"sort_no":130,"sortable":true,"type":"number"},"type":"number","digits":2},{"name":"付款比例","code":"finance_payment_report_item_payment_sacle","is_wide":false,"is_list_display":false,"is_searchable":false,"is_required":false,"is_multiselect":false,"_id":"65a8c5178a8fe305be00e7e4","steedos_field":{"name":"payment_sacle","data_type":"percent","filterable":false,"formula":"amount / purchase_order.amount","formula_blank_value":"zeroes","hidden":false,"index":false,"is_name":false,"is_wide":false,"label":"付款比例","omit":false,"readonly":false,"required":false,"searchable":false,"sort_no":640,"sortable":false,"type":"formula"},"type":"number","is_percent":true},{"name":"备注","code":"finance_payment_report_item_amount_description","is_wide":true,"is_list_display":false,"is_searchable":false,"is_required":false,"is_multiselect":false,"_id":"65a8c5178a8fe305be00e7e5","steedos_field":{"name":"amount_description","filterable":false,"hidden":false,"index":false,"is_name":false,"is_wide":true,"label":"备注","omit":false,"readonly":false,"required":false,"rows":0,"searchable":false,"sort_no":500,"sortable":false,"type":"textarea"},"type":"input","is_textarea":true}],"_id":"65a8c5178a8fe305be00e7e6","relatedId":"finance_payment_report_item.report_id"}],"modified_by":"bd6eb4d7-0eca-4c19-b9f5-30ce6a28bfc4","start_date":"2024-01-18T06:26:30.206Z"},"company_ids":["65a8bd3c8a8fe305be00e788"],"historys":[],"category_name":"应付管理","instance_number_rules":[],"flows":[{"_id":"s5m5MrDh4Sj3NcRmv","space":"65a8bd3c8a8fe305be00e788","form":"4d9983f0-7f7c-4000-a027-30f1678c","name_formula":"","code_formula":"","is_valid":true,"flowtype":"new","state":"enabled","description":null,"help_text":null,"error_message":"","current_no":1,"is_deleted":false,"created":"2024-01-18T06:20:45.016Z","created_by":"bd6eb4d7-0eca-4c19-b9f5-30ce6a28bfc4","modified":"2024-01-18T06:26:30.237Z","modified_by":"bd6eb4d7-0eca-4c19-b9f5-30ce6a28bfc4","name":"合同付款审批","app":"workflow","category":"65a8bd3c8a8fe305be00e788_912ba129ee6464951bc9cda1","company_id":"65a8bd3c8a8fe305be00e788","object_name":"finance_payment_reports","instance_fields":[{"name":"supplier","label":"供应商","required":true},{"name":"supplier_bank","label":"供应商收款账户","required":false},{"name":"amount","label":"付款金额","required":false},{"name":"due_date","label":"计划付款日期","required":true},{"name":"payment_account","label":"付款账户","required":true},{"name":"id","label":"付款单编号","required":false},{"name":"billno","label":"单据编号","required":false},{"name":"amount_description","label":"备注","required":false}],"instance_table_fields":[{"detail_field_fullname":"finance_payment_report_item.report_id","sort_order":"asc","field_names":["id","purchase_order","contract_amount","amount","payment_sacle","amount_description"],"value":"付款明细","label":"付款明细"}],"perms":{"orgs_can_add":["65a8bd3c8a8fe305be00e788"],"_id":"t8wACnpDPLRRYXD4n"},"current":{"_id":"iwKeZm5XtMzHegrm8","steps":[{"name":"开始","step_type":"start","deal_type":"","description":"","posx":361.75,"posy":446,"timeout_hours":168,"approver_users":[],"approver_orgs":[],"approver_user_field":"","approver_org_field":"","approver_roles":[],"approver_step":"","lines":[{"name":"","state":"submitted","to_step":"8599d17c-f161-4a13-8bb2-214388c2aa1a","description":"","timeout_line":false,"_id":"ZFuFjsw76GugRnSpB"}],"permissions":{"__form":"editable","account_banks":"editable","amount":"editable","amount_description":"editable","billno":"editable","currency":"editable","due_date":"editable","finished":"editable","id":"editable","name":"editable","payment_account":"editable","payment_date":"editable","payment_method":"editable","payment_status":"editable","payment_type":"editable","supplier":"editable","supplier_bank":"editable","ticket_information":"editable"},"can_edit_main_attach":false,"can_edit_normal_attach":true,"always_enter_step":true,"_id":"48PGzejm5XsDjrDBL","fields_modifiable":[],"approver_roles_name":[],"approver_roles_api_name":[],"approver_hr_roles_name":[],"approver_hr_roles_api_name":[]},{"name":"结束","step_type":"end","deal_type":"","description":"","posx":1143.25,"posy":446,"approver_users":[],"approver_orgs":[],"approver_user_field":"","approver_org_field":"","approver_roles":[],"approver_step":"","permissions":{},"always_enter_step":true,"_id":"gpYC4EtCwpXtYF2ui","fields_modifiable":[],"approver_roles_name":[],"approver_roles_api_name":[],"approver_hr_roles_name":[],"approver_hr_roles_api_name":[]},{"name":"审批","step_type":"sign","deal_type":"pickupAtRuntime","description":"","posx":778,"posy":433,"timeout_hours":168,"approver_users":[],"approver_orgs":[],"approver_user_field":"","approver_org_field":"","approver_roles":[],"approver_hr_roles":[],"approver_step":"","lines":[{"name":"","state":"approved","to_step":"gpYC4EtCwpXtYF2ui","description":"","timeout_line":false}],"permissions":{},"disableCC":false,"allowDistribute":false,"can_edit_main_attach":false,"can_edit_normal_attach":true,"cc_must_finished":false,"cc_alert":false,"allow_pick_approve_users":false,"allow_skip":false,"cc_has_edit_permission":false,"always_enter_step":true,"enter_step_condition":"","_id":"8599d17c-f161-4a13-8bb2-214388c2aa1a","fields_modifiable":[],"approver_roles_name":[],"approver_roles_api_name":[],"approver_hr_roles_name":[],"approver_hr_roles_api_name":[]}],"_rev":1,"flow":"s5m5MrDh4Sj3NcRmv","form_version":"4d9983f0-7f7c-4000-a027-30f1678c","created":"2024-01-18T06:20:44.991Z","created_by":"bd6eb4d7-0eca-4c19-b9f5-30ce6a28bfc4","modified":"2024-01-18T06:26:30.206Z","modified_by":"bd6eb4d7-0eca-4c19-b9f5-30ce6a28bfc4","start_date":"2024-01-18T06:26:30.206Z"},"company_ids":["65a8bd3c8a8fe305be00e788"],"api_name":"purchase_order_apply","forbid_initiate_instance":true,"historys":[],"object_workflows":[{"_id":"7BG3KsWuYk9WQjCFv","name":"合同付款审批-付款单","object_name":"finance_payment_reports","flow_id":"s5m5MrDh4Sj3NcRmv","sync_attachment":"lastest","sync_type":"every_step","sync_direction":"both","field_map_back":[{"object_field":"supplier","workflow_field":"supplier"},{"object_field":"supplier_bank","workflow_field":"supplier_bank"},{"object_field":"amount","workflow_field":"amount"},{"object_field":"due_date","workflow_field":"due_date"},{"object_field":"payment_account","workflow_field":"payment_account"},{"object_field":"id","workflow_field":"id"},{"object_field":"billno","workflow_field":"billno"},{"object_field":"amount_description","workflow_field":"amount_description"},{"object_field":"finance_payment_report_item.id","workflow_field":"finance_payment_report_item.finance_payment_report_item_id"},{"object_field":"finance_payment_report_item.purchase_order","workflow_field":"finance_payment_report_item.finance_payment_report_item_purchase_order"},{"object_field":"finance_payment_report_item.contract_amount","workflow_field":"finance_payment_report_item.finance_payment_report_item_contract_amount"},{"object_field":"finance_payment_report_item.amount","workflow_field":"finance_payment_report_item.finance_payment_report_item_amount"},{"object_field":"finance_payment_report_item.payment_sacle","workflow_field":"finance_payment_report_item.finance_payment_report_item_payment_sacle"},{"object_field":"finance_payment_report_item.amount_description","workflow_field":"finance_payment_report_item.finance_payment_report_item_amount_description"}],"field_map":[{"object_field":"supplier","workflow_field":"supplier"},{"object_field":"supplier_bank","workflow_field":"supplier_bank"},{"object_field":"amount","workflow_field":"amount"},{"object_field":"due_date","workflow_field":"due_date"},{"object_field":"payment_account","workflow_field":"payment_account"},{"object_field":"id","workflow_field":"id"},{"object_field":"billno","workflow_field":"billno"},{"object_field":"amount_description","workflow_field":"amount_description"},{"object_field":"finance_payment_report_item.id","workflow_field":"finance_payment_report_item.finance_payment_report_item_id"},{"object_field":"finance_payment_report_item.purchase_order","workflow_field":"finance_payment_report_item.finance_payment_report_item_purchase_order"},{"object_field":"finance_payment_report_item.contract_amount","workflow_field":"finance_payment_report_item.finance_payment_report_item_contract_amount"},{"object_field":"finance_payment_report_item.amount","workflow_field":"finance_payment_report_item.finance_payment_report_item_amount"},{"object_field":"finance_payment_report_item.payment_sacle","workflow_field":"finance_payment_report_item.finance_payment_report_item_payment_sacle"},{"object_field":"finance_payment_report_item.amount_description","workflow_field":"finance_payment_report_item.finance_payment_report_item_amount_description"}],"lock_record_after_approval":true}]}],"api_name":"purchase_order_apply"}