{"name":"开票审批","state":"enabled","is_deleted":false,"is_valid":true,"space":"659f4896aa258a05be3d5893","app":"workflow","created":"2024-01-11T01:47:03.298Z","modified":"2024-01-11T02:25:35.359Z","modified_by":"bd6eb4d7-0eca-4c19-b9f5-30ce6a28bfc4","category":"659f4896aa258a05be3d5893_912ba129ee6464951bc9cdac","instance_style":"table","current":{"_id":"069ba39966a799a57b5dcc0a","form":"5db41eed0c51d4aeccb61f46","_rev":1,"created":"2024-01-11T01:47:03.298Z","modified":"2024-01-11T02:23:41.469Z","fields":[{"name":"编号","code":"id","is_wide":false,"is_list_display":false,"is_searchable":true,"is_required":false,"is_multiselect":false,"_id":"659f512daa258a05be3d58c1","type":"input"},{"name":"名称","code":"name","is_wide":false,"is_list_display":false,"is_searchable":false,"is_required":true,"is_multiselect":false,"_id":"659f512daa258a05be3d58c2","type":"input"},{"name":"应收合同","code":"contract","is_wide":false,"is_list_display":false,"is_searchable":false,"is_required":true,"is_multiselect":false,"_id":"659f512daa258a05be3d58c3","type":"lookup","reference_to":"sales_orders","config":"{}"},{"name":"客户","code":"account","is_wide":false,"is_list_display":false,"is_searchable":false,"is_required":true,"is_multiselect":false,"_id":"659f512daa258a05be3d58c4","type":"lookup","reference_to":"accounts","config":"{}"},{"name":"付款方银行账号","code":"customer_bank","is_wide":false,"is_list_display":false,"is_searchable":false,"is_required":true,"is_multiselect":false,"_id":"659f512daa258a05be3d58c5","type":"lookup","reference_to":"account_banks","config":"{}"},{"name":"开票金额","code":"money","is_wide":false,"is_list_display":false,"is_searchable":false,"is_required":true,"is_multiselect":false,"_id":"659f512daa258a05be3d58c6","type":"number","digits":2},{"name":"税率","code":"tax","is_wide":false,"is_list_display":false,"is_searchable":false,"is_required":true,"is_multiselect":false,"_id":"659f512daa258a05be3d58c7","type":"lookup","reference_to":"tax_rates","config":"{}"},{"name":"发票类型","code":"invoice_type","is_wide":false,"is_list_display":false,"is_searchable":false,"is_required":true,"is_multiselect":false,"_id":"659f512daa258a05be3d58c8","type":"lookup","reference_to":"invoice_type","config":"{}"},{"name":"纳税人识别号","code":"credit_code","is_wide":false,"is_list_display":false,"is_searchable":false,"is_required":false,"is_multiselect":false,"_id":"659f512daa258a05be3d58c9","type":"input"},{"name":"开户行","code":"bank","is_wide":false,"is_list_display":false,"is_searchable":false,"is_required":false,"is_multiselect":false,"_id":"659f512daa258a05be3d58ca","type":"input"},{"name":"地址","code":"address","is_wide":false,"is_list_display":false,"is_searchable":false,"is_required":false,"is_multiselect":false,"_id":"659f512daa258a05be3d58cb","type":"input"},{"name":"电话","code":"phone","is_wide":false,"is_list_display":false,"is_searchable":false,"is_required":false,"is_multiselect":false,"_id":"659f512daa258a05be3d58cc","type":"input"},{"name":"已开票","code":"is_active","is_wide":false,"is_list_display":false,"is_searchable":false,"is_required":false,"is_multiselect":false,"default_value":false,"_id":"659f512daa258a05be3d58cd","type":"checkbox"},{"name":"开票日期","code":"actual_date","is_wide":false,"is_list_display":false,"is_searchable":false,"is_required":false,"is_multiselect":false,"_id":"659f512daa258a05be3d58ce","type":"date"},{"name":"备注(特殊要求)","code":"remark","is_wide":true,"is_list_display":false,"is_searchable":false,"is_required":false,"is_multiselect":false,"_id":"659f512daa258a05be3d58cf","type":"input","is_textarea":true},{"name":"发票数","code":"count","is_wide":false,"is_list_display":false,"is_searchable":false,"is_required":false,"is_multiselect":false,"_id":"659f512daa258a05be3d58d0","type":"number","digits":0,"is_percent":true},{"name":"发票总金额","code":"sumprice","is_wide":false,"is_list_display":false,"is_searchable":false,"is_required":false,"is_multiselect":false,"_id":"659f512daa258a05be3d58d1","type":"number","digits":2,"is_percent":true},{"type":"table","name":"开票明细","code":"finance_invoice_detail","is_wide":true,"is_required":false,"fields":[{"name":"发票号码","code":"finance_invoice_detail_invoice_number","is_wide":false,"is_list_display":false,"is_searchable":false,"is_required":false,"is_multiselect":false,"_id":"659f512daa258a05be3d58d2","type":"input"},{"name":"发票代码","code":"finance_invoice_detail_invoice_code","is_wide":false,"is_list_display":false,"is_searchable":false,"is_required":false,"is_multiselect":false,"_id":"659f512daa258a05be3d58d3","type":"input"},{"name":"开票日期","code":"finance_invoice_detail_bill_date","is_wide":false,"is_list_display":false,"is_searchable":false,"is_required":false,"is_multiselect":false,"_id":"659f512daa258a05be3d58d4","type":"date"},{"name":"价税合计","code":"finance_invoice_detail_amount","is_wide":false,"is_list_display":false,"is_searchable":false,"is_required":true,"is_multiselect":false,"_id":"659f512daa258a05be3d58d5","type":"number","digits":2},{"name":"客户","code":"finance_invoice_detail_account","is_wide":false,"is_list_display":false,"is_searchable":false,"is_required":true,"is_multiselect":false,"_id":"659f512daa258a05be3d58d6","type":"lookup","reference_to":"accounts","config":"{}"},{"name":"税率","code":"finance_invoice_detail_tax","is_wide":false,"is_list_display":false,"is_searchable":false,"is_required":false,"is_multiselect":false,"_id":"659f512daa258a05be3d58d7","type":"lookup","reference_to":"tax_rates","config":"{}"}],"_id":"659f512daa258a05be3d58d8"}],"modified_by":"bd6eb4d7-0eca-4c19-b9f5-30ce6a28bfc4","start_date":"2023-11-19T06:20:18.473Z","created_by":"bd6eb4d7-0eca-4c19-b9f5-30ce6a28bfc4","name_forumla":"{id}+\"-\"+{name}"},"api_name":"finance_invoicing","created_by":"bd6eb4d7-0eca-4c19-b9f5-30ce6a28bfc4","import":true,"owner":"bd6eb4d7-0eca-4c19-b9f5-30ce6a28bfc4","description":null,"error_message":null,"help_text":null,"company_id":"659f4896aa258a05be3d5893","company_ids":["659f4896aa258a05be3d5893"],"historys":[],"category_name":"应收管理","instance_number_rules":[],"flows":[{"_id":"7a98deca9a6531afc3892dda","space":"659f4896aa258a05be3d5893","form":"5db41eed0c51d4aeccb61f46","name_formula":"","code_formula":"","is_valid":true,"flowtype":"new","state":"enabled","description":null,"help_text":null,"error_message":"","current_no":1,"is_deleted":false,"created":"2024-01-11T01:47:03.300Z","created_by":"bd6eb4d7-0eca-4c19-b9f5-30ce6a28bfc4","modified":"2024-01-11T02:25:35.348Z","modified_by":"bd6eb4d7-0eca-4c19-b9f5-30ce6a28bfc4","name":"开票审批","app":"workflow","category":"659f4896aa258a05be3d5893_912ba129ee6464951bc9cdac","object_name":"finance_invoice","instance_fields":[{"name":"id","filterable":true,"formula":"KP-{YYYY}-{0000}","hidden":false,"index":false,"is_name":true,"is_wide":false,"label":"编号","omit":false,"readonly":true,"required":false,"searchable":false,"sort_no":235,"sortable":true,"type":"autonumber","visible_on":"{{global.mode ==='read' ? true : false}}","object_name":"finance_invoice"},{"name":"name","filterable":true,"hidden":false,"index":true,"is_name":false,"is_wide":false,"label":"名称","omit":false,"readonly":false,"required":true,"searchable":true,"sort_no":100,"sortable":false,"type":"text","object_name":"finance_invoice"},{"name":"contract","filterable":true,"hidden":false,"index":false,"is_name":false,"is_wide":false,"label":"合同","omit":false,"readonly":false,"create":false,"reference_to":"contracts","required":true,"searchable":false,"sort_no":130,"sortable":false,"type":"master_detail","write_requires_master_read":true,"object_name":"finance_invoice","_filtersFunction":"function anonymous(filters,values\n) {\n\n  if(values == undefined){\n    return [];\n  }else{\n    return [[\"collection\",\"=\",true]];\n  }\n\n}"},{"name":"account","filterable":true,"hidden":false,"index":false,"is_name":false,"is_wide":false,"label":"付款方名称","multiple":false,"omit":false,"readonly":false,"reference_to":"accounts","required":true,"searchable":false,"sort_no":140,"sortable":false,"type":"lookup","create":false,"depend_on":["contract"],"object_name":"finance_invoice","_filtersFunction":"function anonymous(filters,values\n) {\n\n    const contract = values.contract;\n    if (!contract) {\n      return ['_id', '=', 'none'];\n    } else {\n      const queryResult = Steedos.authRequest(`/graphql`, {\n                            type: 'POST', async: false, \n                            data: JSON.stringify({\n                              query: `{contracts(filters: [\"_id\",\"=\", `+ JSON.stringify(contract) + `]){_id, othercompany__expand{_id}}}`\n                            })\n                          });\n      const accounts = queryResult && queryResult.data && queryResult.data.contracts[0].othercompany__expand;\n      const ids = new Array();\n      for (const item of accounts) {\n        ids.push(item._id);\n      }\n      return [\"_id\", \"in\", ids];\n    }\n\n}"},{"name":"customer_bank","filterable":false,"hidden":false,"index":false,"is_name":false,"is_wide":false,"label":"付款方银行账号","multiple":false,"create":false,"omit":false,"depend_on":["account"],"readonly":false,"reference_to":"account_banks","required":true,"searchable":false,"sort_no":150,"sortable":false,"type":"lookup","object_name":"finance_invoice","_filtersFunction":"function anonymous(filters,values\n) {\n\n    const account = values.account;\n    if (!account) {\n      return ['_id', '=', 'none'];\n    } else {\n      return [\"account\", \"=\", account];\n    }\n\n}"},{"name":"money","filterable":false,"hidden":false,"index":false,"is_name":false,"is_wide":false,"label":"金额","omit":false,"precision":18,"readonly":false,"required":true,"scale":2,"searchable":false,"sort_no":160,"sortable":false,"type":"currency","object_name":"finance_invoice"},{"name":"tax","filterable":false,"hidden":false,"index":false,"is_name":false,"is_wide":false,"label":"税率","multiple":false,"omit":false,"readonly":false,"reference_to":"tax_rates","required":true,"searchable":false,"sort_no":165,"sortable":false,"type":"lookup","object_name":"finance_invoice"},{"name":"invoice_type","filterable":true,"hidden":false,"index":false,"is_name":false,"is_wide":false,"label":"发票种类","multiple":false,"omit":false,"readonly":false,"reference_to":"invoice_type","required":true,"searchable":false,"sort_no":170,"sortable":false,"type":"lookup","object_name":"finance_invoice"},{"name":"credit_code","data_type":"text","filterable":false,"formula":"account.credit_code","formula_blank_value":"blanks","hidden":false,"index":false,"is_name":false,"is_wide":false,"label":"纳税人识别号","omit":false,"readonly":false,"required":false,"searchable":false,"sort_no":180,"sortable":false,"type":"formula","object_name":"finance_invoice"},{"name":"bank","data_type":"text","filterable":false,"formula":"account.invoice_bank","formula_blank_value":"blanks","hidden":false,"index":false,"is_name":false,"is_wide":false,"label":"开户行","omit":false,"readonly":false,"required":false,"searchable":false,"sort_no":190,"sortable":false,"type":"formula","object_name":"finance_invoice"},{"name":"address","data_type":"text","filterable":false,"formula":"account.invoice_address","formula_blank_value":"blanks","hidden":false,"index":false,"is_name":false,"is_wide":false,"label":"地址","omit":false,"readonly":false,"required":false,"searchable":false,"sort_no":200,"sortable":false,"type":"formula","object_name":"finance_invoice"},{"name":"phone","data_type":"text","filterable":false,"formula":"account.invoice_phone","formula_blank_value":"blanks","hidden":false,"index":false,"is_name":false,"is_wide":false,"label":"电话","omit":false,"readonly":false,"required":false,"searchable":false,"sort_no":210,"sortable":false,"type":"formula","object_name":"finance_invoice"},{"name":"is_active","defaultValue":false,"label":"已开票","sort_no":300,"type":"toggle","object_name":"finance_invoice"},{"name":"actual_date","filterable":true,"hidden":false,"index":false,"is_name":false,"is_wide":false,"label":"开票日期","omit":false,"readonly":false,"required":false,"searchable":false,"sort_no":310,"sortable":false,"type":"date","object_name":"finance_invoice"},{"name":"remark","filterable":false,"hidden":false,"index":false,"is_name":false,"is_wide":true,"label":"备注(特殊要求)","omit":false,"readonly":false,"required":false,"rows":0,"searchable":false,"sort_no":310,"sortable":false,"type":"textarea","object_name":"finance_invoice"},{"name":"count","data_type":"number","filterable":false,"group":"已开票信息","hidden":false,"index":false,"is_name":false,"is_wide":false,"label":"发票数","omit":true,"precision":18,"readonly":false,"required":false,"scale":0,"searchable":false,"sort_no":410,"sortable":false,"summary_object":"finance_invoice_detail","summary_type":"count","type":"summary","summary_filters":[],"object_name":"finance_invoice"},{"name":"sumprice","data_type":"number","filterable":false,"group":"已开票信息","hidden":false,"index":false,"is_name":false,"is_wide":false,"label":"发票总金额","omit":true,"precision":18,"readonly":false,"required":false,"scale":2,"searchable":false,"sort_no":420,"sortable":false,"summary_field":"amount","summary_object":"finance_invoice_detail","summary_type":"sum","type":"summary","summary_filters":[],"object_name":"finance_invoice"}],"instance_table_fields":[{"detail_field_fullname":"finance_invoice_detail.invoiceapply","sort_order":"asc","index":"","field_names":["invoice_number","invoice_code","bill_date","amount","account","tax"]}],"perms":{"_id":"aa4371c1f32c776710ef2d94","users_can_add":[],"orgs_can_add":["659f4896aa258a05be3d5893"],"users_can_monitor":[],"orgs_can_monitor":[],"users_can_admin":[],"orgs_can_admin":[]},"current":{"_id":"ce75db9a0a5a0b71deb0b8c9","steps":[{"name":"开始","step_type":"start","deal_type":"","description":"","posx":361.75,"posy":420.5,"timeout_hours":168,"approver_users":[],"approver_orgs":[],"approver_user_field":"","approver_org_field":"","approver_roles":[],"approver_step":"","lines":[{"name":"","state":"submitted","to_step":"58fb4c11-69f8-4ce0-8e6b-1c86eff0dc8b","description":"","timeout_line":false,"_id":"EueWQoBvPZCJRXSu3"}],"permissions":{"__form":"editable","account":"editable","actual_date":"editable","address":"editable","amount_type":"editable","bank":"editable","contract":"editable","contract_receipts":"editable","count":"editable","credit_code":"editable","currency":"editable","customer_bank":"editable","excluding_tax_amount":"editable","id":"editable","invoice_type":"editable","is_active":"editable","money":"editable","name":"editable","phone":"editable","project":"editable","remark":"editable","specification_model":"editable","sumprice":"editable","tax":"editable","ticket_information":"editable","unit":"editable"},"can_edit_main_attach":false,"can_edit_normal_attach":true,"_id":"KxE2m6oSbPJHSpLii","fields_modifiable":[],"approver_roles_api_name":[],"approver_hr_roles_name":[],"approver_hr_roles_api_name":[],"approver_roles_name":[]},{"name":"结束","step_type":"end","deal_type":"","description":"","posx":1143.25,"posy":420.5,"approver_users":[],"approver_orgs":[],"approver_user_field":"","approver_org_field":"","approver_roles":[],"approver_step":"","permissions":{},"_id":"TqLEDXTFnqAJPzP3C","fields_modifiable":[],"approver_roles_api_name":[],"approver_hr_roles_name":[],"approver_hr_roles_api_name":[],"approver_roles_name":[]},{"name":"审批","step_type":"sign","deal_type":"pickupAtRuntime","description":"","posx":796,"posy":418,"timeout_hours":168,"approver_users":[],"approver_orgs":[],"approver_user_field":"","approver_org_field":"","approver_roles":[],"approver_hr_roles":[],"approver_step":"","lines":[{"name":"","state":"approved","to_step":"TqLEDXTFnqAJPzP3C","description":"","timeout_line":false}],"permissions":{},"disableCC":false,"allowDistribute":false,"can_edit_main_attach":false,"can_edit_normal_attach":true,"cc_must_finished":false,"cc_alert":false,"allow_pick_approve_users":false,"allow_skip":false,"cc_has_edit_permission":false,"_id":"58fb4c11-69f8-4ce0-8e6b-1c86eff0dc8b","fields_modifiable":[],"approver_roles_api_name":[],"approver_hr_roles_name":[],"approver_hr_roles_api_name":[],"approver_roles_name":[]}],"_rev":1,"flow":"7a98deca9a6531afc3892dda","form_version":"069ba39966a799a57b5dcc0a","created":"2024-01-11T01:47:03.300Z","created_by":"bd6eb4d7-0eca-4c19-b9f5-30ce6a28bfc4","modified":"2024-01-11T01:47:03.300Z","modified_by":"bd6eb4d7-0eca-4c19-b9f5-30ce6a28bfc4","start_date":"2023-11-19T06:20:18.473Z"},"api_name":"finance_invoicing","instances":null,"sort_no":null,"forbid_initiate_instance":true,"historys":[],"import":true,"owner":"bd6eb4d7-0eca-4c19-b9f5-30ce6a28bfc4","company_id":"659f4896aa258a05be3d5893","company_ids":["659f4896aa258a05be3d5893"],"object_workflows":[{"_id":"NShRfoJcAdmCehax7","name":"开票审批-开票","object_name":"finance_invoice","flow_id":"7a98deca9a6531afc3892dda","sync_attachment":"lastest","sync_type":"every_step","sync_direction":"both","field_map_back":[{"object_field":"id","workflow_field":"id"},{"object_field":"name","workflow_field":"name"},{"object_field":"contract","workflow_field":"contract"},{"object_field":"account","workflow_field":"account"},{"object_field":"customer_bank","workflow_field":"customer_bank"},{"object_field":"money","workflow_field":"money"},{"object_field":"tax","workflow_field":"tax"},{"object_field":"invoice_type","workflow_field":"invoice_type"},{"object_field":"credit_code","workflow_field":"credit_code"},{"object_field":"bank","workflow_field":"bank"},{"object_field":"address","workflow_field":"address"},{"object_field":"phone","workflow_field":"phone"},{"object_field":"is_active","workflow_field":"is_active"},{"object_field":"actual_date","workflow_field":"actual_date"},{"object_field":"remark","workflow_field":"remark"},{"object_field":"count","workflow_field":"count"},{"object_field":"sumprice","workflow_field":"sumprice"},{"object_field":"finance_invoice_detail.invoice_number","workflow_field":"finance_invoice_detail.finance_invoice_detail_invoice_number"},{"object_field":"finance_invoice_detail.invoice_code","workflow_field":"finance_invoice_detail.finance_invoice_detail_invoice_code"},{"object_field":"finance_invoice_detail.bill_date","workflow_field":"finance_invoice_detail.finance_invoice_detail_bill_date"},{"object_field":"finance_invoice_detail.amount","workflow_field":"finance_invoice_detail.finance_invoice_detail_amount"},{"object_field":"finance_invoice_detail.account","workflow_field":"finance_invoice_detail.finance_invoice_detail_account"},{"object_field":"finance_invoice_detail.tax","workflow_field":"finance_invoice_detail.finance_invoice_detail_tax"}],"field_map":[{"object_field":"id","workflow_field":"id"},{"object_field":"name","workflow_field":"name"},{"object_field":"contract","workflow_field":"contract"},{"object_field":"account","workflow_field":"account"},{"object_field":"customer_bank","workflow_field":"customer_bank"},{"object_field":"money","workflow_field":"money"},{"object_field":"tax","workflow_field":"tax"},{"object_field":"invoice_type","workflow_field":"invoice_type"},{"object_field":"credit_code","workflow_field":"credit_code"},{"object_field":"bank","workflow_field":"bank"},{"object_field":"address","workflow_field":"address"},{"object_field":"phone","workflow_field":"phone"},{"object_field":"is_active","workflow_field":"is_active"},{"object_field":"actual_date","workflow_field":"actual_date"},{"object_field":"remark","workflow_field":"remark"},{"object_field":"count","workflow_field":"count"},{"object_field":"sumprice","workflow_field":"sumprice"},{"object_field":"finance_invoice_detail.invoice_number","workflow_field":"finance_invoice_detail.finance_invoice_detail_invoice_number"},{"object_field":"finance_invoice_detail.invoice_code","workflow_field":"finance_invoice_detail.finance_invoice_detail_invoice_code"},{"object_field":"finance_invoice_detail.bill_date","workflow_field":"finance_invoice_detail.finance_invoice_detail_bill_date"},{"object_field":"finance_invoice_detail.amount","workflow_field":"finance_invoice_detail.finance_invoice_detail_amount"},{"object_field":"finance_invoice_detail.account","workflow_field":"finance_invoice_detail.finance_invoice_detail_account"},{"object_field":"finance_invoice_detail.tax","workflow_field":"finance_invoice_detail.finance_invoice_detail_tax"}],"lock_record_after_approval":true}]}]}