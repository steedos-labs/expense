extend: organizations
fields:
  qywx_id:
    label: 企业微信部门ID
    type: text
    hidden: false
    sort_no: 150
    group: 高级
  qywx_space:
    label: 企业微信工作区
    type: text
    hidden: true
# actions:
#   sync_contacts:
#     label: 下载企业微信通讯录
#     visible: !<tag:yaml.org,2002:js/function> |-
#       function (object_name, record_id, record_permissions ,record) {
#         if(record.__super.__super.__super.__super.global.user.profile=="admin"){
#            return true;
#         }else{
#            return false;
#         }
       
#       }
#     'on': list
#     todo: !<tag:yaml.org,2002:js/function> |-
#       function (object_name, record_id, fields) {
#         console.log("sync contact------------")
#         let url = `/api/qiyeweixin/suite/downloadContact`;
        
#         let options = {
#             type: 'post',
#             async: true,
#             data: JSON.stringify({ space_id: Steedos.spaceId() }),
#             success: function (data) {
#               console.log("success---------: ",data)
#               let i = 1;
#               let request = setInterval(function(){
                
#                 try{
#                   if (i > 9){
#                     clearInterval(request);
#                   }
#                   let requestUrl = `/api/qiyeweixin/suite/getResult`
#                   let requestOptions = {
#                       type: 'post',
#                       async: false,
#                       data: JSON.stringify({ spaceId: Steedos.spaceId()}),
#                   }
#                   let res = Steedos.authRequest(requestUrl, requestOptions);
#                   console.log("res: ", res);
#                   if (res){
#                     clearInterval(request)
#                     window.open(res,"_blank")
#                   }
#                   i++;
#                 }catch(error){
#                   clearInterval(request);
#                   console.log("error:",error)
#                 } 
                
#               },3000)
#             },
#             error: function (XMLHttpRequest, textStatus, errorThrown) {
#               console.log("同步企业微信通讯录失败！")
#             }
#         };

        
#         Steedos.authRequest(url, options);
#       }